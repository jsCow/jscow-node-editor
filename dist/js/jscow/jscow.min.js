jsCow=function(){var jsCowBase=function(){this.config={version:"2.0.0",url:{base:""},zIndex:1},this.componentsObjectList=[],this.res={core:{mvc:{},events:{}},components:{},model:{},view:{},controller:{}},this.events={},this.cache={},this.debug={events:!1,controller:!1,model:!1,view:!1}};return jsCowBase.prototype={nextZIndex:function(){return this.config.zIndex++,this.config.zIndex},cache:function(index,value){if(index&&value)void 0===this.cache[index]&&(this.cache[index]=!1),this.cache[index]=value;else{if(!index)return this.cache;if(this.cache[index])return this.cache[index]}return this},removeCache:function(index){return delete this.cache[index],this},get:function(cmp,preConfig){return this.components.get(cmp,preConfig)},find:function(cmp){return this.components.find(cmp)}},new jsCowBase}(),jsCow.res.core.events.eventsManager=function(){this.__cfg__=!1,this.__cmp__=!1,this.parentClass=!1},jsCow.res.core.events.eventsManager.prototype={cmp:function(cmp){return void 0!==cmp?(this.__cmp__=cmp,this):this.__cmp__},isNot:function(local){return!local},parent:function(parentClass){return void 0!==parentClass?(this.parentClass=parentClass,this):this.parentClass},on:function(event,h,l){var handler=h,local=l;void 0===handler&&(handler=!1);var sender=this.cmp(),parentClass=this.parentClass;return local="undefined"==typeof local||local===!0,void 0!==event&&sender?"function"==typeof handler?(void 0===jsCow.events[event]&&(jsCow.events[event]=Array()),jsCow.events[event].push({event:event,handler:handler,sender:sender,that:parentClass,local:local})):jsCow.debug.events&&console.warn("There is not defined a handler method for event '"+event+"' in '"+this.cmp().id()+"'. The event trigger will be ignored!"):console.error("There have to be defined an event name for the event listener in '"+this.cmp().id()+"'!"),this},off:function(event,cmp){jsCow.events[event]&&$.each(jsCow.events[event],function(i,evt){jsCow.events[event][i].getID()===cmp.getID()&&jsCow.events[event][i].slice(i,1)})},trigger:function(event,d,l){var config=this.cmp().config(),data=d,local=l;if(data="undefined"!=typeof d&&d?"object"==typeof d?d:{}:config){var self=this;local="undefined"!=typeof local&&local?!1:this.cmp(),void 0!==jsCow.events[event]&&$.each(jsCow.events[event],function(self,event,data,local){return function(i,e){"object"==typeof local&&local.id()===e.sender.id()&&e.local?setTimeout(function(){jsCow.debug.events&&console.log("local :: trigger event ","'"+e.event+"'","from","'"+self.cmp().id()+"' for '"+e.that.id()+"'."),e.handler.apply(e.that,[{data:data,sender:self.cmp(),date:new Date}])},0):self.isNot(local)===e.local&&setTimeout(function(){jsCow.debug.events&&console.log("global :: trigger even","'"+e.event+"'","from","'"+self.cmp().id()+"' for '"+e.that.id()+"'."),e.handler.apply(e.that,[{data:data,sender:self.cmp(),date:new Date}])},0)}}(self,event,data,local))}return this},bubbleOut:function(event,data,local){var bubble=this.bubbleTrigger(event,data,local);bubble&&this.cmp().parent()&&this.cmp().parent().bubbleOut(event,data,local)},bubbleIn:function(event,data,local){var bubble=this.bubbleTrigger(event,data,local);if(bubble&&this.cmp().children().length>0){var children=this.cmp().children();$.each(children,function(self){return function(i,c){c.bubbleIn(event,data,local)}}(this))}},bubble:function(event,data,local){var bubble=this.bubbleTrigger(event,data,local);bubble&&(this.bubbleOut(event,data,local),this.bubbleIn(event,data,local))},bubbleTrigger:function(event,data,local){var bubble=!0;return this.trigger(event,data,local),bubble}};var component=function(){};component.prototype={get:function(cmpClassReference,preConfig){var c=new cmpClassReference;if("object"==typeof c){"undefined"!=typeof preConfig?c.__preConfig__=preConfig:c.__preConfig__={},c.events=!1,c.__model__=!1,c.__view__=!1,c.__controller__=!1,c.__cfg__={},c.__cfg__.parent=!1,c.__cfg__.dom=!1,c.__cfg__.layerindex=0,c.__cfg__.initialized=[],c.__cfg__.__execInit__=!1,c.__cfg__.rendered=!1,c.__cfg__.placeholder=!1,c.__cfg__.id=!1,c.__cfg__.target=!1,c.__children__=[],c.extension=!1,c=$.extend(!0,c,{add:function(childs){var list=[];return childs instanceof Array?list=childs:list.push(childs),$.each(list,function(self){return function(i,child){if("object"==typeof child&&!child.__cfg__.__execInit__){var content=self.view().content();content?content.append(child.placeholder()):content=self.placeholder(),child.parent(self),child.target(content),self.__children__.push(child)}}}(this)),this},createPlaceholder:function(index){var ph=$('<div class="jsc-ph-'+index+'"></div>');return this.placeholder(ph),ph},placeholder:function(placeholder){return placeholder?(this.__cfg__.placeholder=placeholder,this.__cfg__.placeholder.appendTo(this.target()),this):this.__cfg__.placeholder},target:function(t){var target=t;return"undefined"==typeof target?(this.__cfg__.target||(this.__cfg__.target=$("body")),this.__cfg__.target):(this.parent()||"undefined"!=typeof target?(this.__cfg__.target=target,this.placeholder().appendTo(this.__cfg__.target)):(this.__cfg__.target=$("body"),target=this.__cfg__.target),this.children.length&&$.each(this.children,function(i,child){child.target(target)}),this)},defineVariables:function(){this.__preConfig__||(this.__preConfig__={}),this.__children__||(this.__children__=[]),this.extension||(this.extension={}),this.__cfg__||(this.__cfg__={}),this.__cfg__.__execInit__||(this.__cfg__.__execInit__=!1),this.__cfg__.apps||(this.__cfg__.apps=[]),this.__cfg__.parent||(this.__cfg__.parent=!1),this.__cfg__.dom||(this.__cfg__.dom={}),this.__cfg__.rendered||(this.__cfg__.rendered=[]),this.__cfg__.placeholder||(this.__cfg__.placeholder=!1),this.__cfg__.initialized||(this.__cfg__.initialized=[]),this.__cfg__.target||(this.__cfg__.target=!1),this.events||(this.events=!1),this.__model__||(this.__model__={}),this.__view__||(this.__view__=[]),this.__controller__||(this.__controller__=[])},append:function(child){return window.setTimeout(function(self,child){return function(){child.config.__execInit__||"object"!=typeof child||(self.add(child),child.__init())}}(this,child),0),this},appendInner:function(child,target){return window.setTimeout(function(self){return function(){if(self.defineVariables(),target&&!child.config.__execInit__&&"object"==typeof child){var placeholder=self.createPlaceholder();target.append(placeholder),child.parent(self),child.placeholder(placeholder),child.target(target),self.__children__.push(child),child.__init()}}}(this),0),child},appendAfterInner:function(child,target){return child.defineVariables(),target&&!child.config.__execInit__&&"object"==typeof child&&(child.parent(this),child.target(this.target()),child.placeholder(!1),target.view().getDomMain().after(child.view().getDomMain()),this.__children__.push(child),child.__init()),child},del:function(cmp){if("undefined"!=typeof cmp&&"object"==typeof cmp)$(this.children()).each(function(self,cmp){return function(i,c){c.id()===cmp.id()&&self.__children__.splice(i,1)}}(this,cmp));else{"undefined"!=typeof this.parent()&&this.parent()&&this.parent().del(this),$(jsCow.componentsObjectList).each(function(self){return function(i,c){"undefined"!==c&&c.id()===self.id()&&(c.view().removeAll(),jsCow.componentsObjectList.splice(i,1))}}(this));var list=this.__children__;list.length>0&&$(list).each(function(i,c){c.del()})}return this},run:function(){this.__init()},__init:function(){this.readyToShow(this),this.extension.init&&"function"==typeof this.extension.init&&this.extension.init(),this.__children__.length?$.each(this.__children__,function(i,c){c.__init()}):this.__show(!0),this.__cfg__.__execInit__=!0,this.events.trigger("init")},__show:function(showNow){this.showComplete(this),(showNow||this.__cfg__.rendered.length===this.__children__.length)&&(this.view().init(),this.events.trigger("controller.init"),this.parent()&&this.parent().__show())},extend:function(method,root){var methodList;if(root===!0)$.extend(!0,this,method);else{var _this=this;if(this.extension)methodList={},$.each(method,function(i,m){methodList[i]=function(_super,m,i){return m._super="function"==typeof _super[i]?_super[i]:function(){},function(){m.apply(_super,arguments)}}(_this,m,i)}),$.extend(!0,this.extension,methodList);else{var ext=function(){};methodList={},$.each(method,function(i,m){methodList[i]=function(_super,m,i){return m._super="function"==typeof _super[i]?_super[i]:function(){},function(){m.apply(_super,arguments)}}(_this,m,i)}),$.extend(!0,ext.prototype,methodList),this.extension=new ext}}return this},move:function(target){if("undefined"!==target&&"object"==typeof target){var targetViewContent=target.view().content();if(this.view().appendTo(targetViewContent),this.parent()){var parentChildIndex=this.parent().children().indexOf(this);this.parent().children().splice(parentChildIndex,1),this.parent(target)}target.__children__.push(this)}return this},id:function(id){return id?(this.__cfg__.id=id,this.trigger("update.id",{id:id}),this):this.__cfg__.id},children:function(){return this.__children__},model:function(){return"undefined"!==this.__model__&&this.__model__?this.__model__:!1},view:function(){return void 0===this.__view__?!1:this.__view__},controller:function(){return void 0===this.__controller__?!1:this.__controller__},config:function(config,value){if(config&&value)this.model().data[config]=value,this.trigger("update",this.config());else{if(!config)return this.model().data;$.extend(!0,this.model().data,config),this.trigger("update",this.config())}return this},parent:function(parent){return parent?(this.__cfg__.parent=parent,this):this.__cfg__.parent},readyToShow:function(c){return this.__cfg__.initialized&&(this.__cfg__.initialized=[]),this.__cfg__.initialized.push(c),this},showComplete:function(c){return this.__cfg__.rendered||(this.__cfg__.rendered=[]),this.__cfg__.rendered.push(c),this},eventsManager:function(eventsManager){eventsManager.cmp(this),this.events=eventsManager},addModel:function(m){this.__model__=new m,this.__model__.__controller__=this.__controller__,"undefined"==typeof this.__model__.data&&(this.__model__.data={});var eventsManager=new jsCow.res.core.events.eventsManager;return eventsManager.cmp(this),eventsManager.parent(this.__model__),this.__model__.events=eventsManager,$.extend(!0,this.__model__,{reset:function(index){return index?this.data[index]&&("object"==typeof this.data[index]&&(this.data[index]={}),"string"==typeof this.data[index]&&(this.data[index]=""),this.data[index]instanceof Array&&(this.data[index]=[])):("object"==typeof this.data&&(this.data={}),"string"==typeof this.data&&(this.data=""),this.data instanceof Array&&(this.data=[])),this},update:function(e){return this.data=$.extend(!0,this.data,e.data),this.trigger("update",this.data),this},id:function(id){return id?(this.__id__=id,this):this.__id__},on:function(event,handler,local){return this.events.on(event,handler,local),this},trigger:function(event,data,local){return this.events.trigger(event,data,local),this},bubbleIn:function(event,data,local){return this.events.bubbleIn(event,data,local),this},bubbleOut:function(event,data,local){return this.events.bubbleOut(event,data,local),this},bubble:function(event,data,local){return this.events.bubble(event,data,local),this}}),this.__model__.id("m"+((new Date).getTime()+""+Math.floor(1e6*Math.random())).substr(0,18)),this.__model__.on("controller.init",this.__model__.init),this.__model__.on("model.update",this.__model__.update),this},addView:function(v){return this.__view__.add(v),this},deleteView:function(v){return this.__view__.del(v),this},deleteController:function(c){return this.__controller__.del(c),this},replaceController:function(o,n){return this.__controller__.replace(o,n),this},addController:function(c){return this.__controller__.add(c),this},replaceView:function(o,n){return this.__view__.replace(o,n),this},cfg:function(option,value){return option&&value?(void 0===this.__cfg__[option]&&(this.__cfg__[option]=!1),this.__cfg__[option]=value,this):option&&!value?("object"==typeof option&&$.extend(!0,this.__cfg__,option),this):this.__cfg__},on:function(event,handler,local){return"undefined"!=typeof this.events.on&&this.events.on(event,handler,local),this},trigger:function(event,data,local){return"undefined"!=typeof this.events.trigger&&this.events.trigger(event,data,local),this},bubbleIn:function(event,data,local){return"undefined"!=typeof this.events.bubbleIn&&this.events.bubbleIn(event,data,local),this},bubbleOut:function(event,data,local){return"undefined"!=typeof this.events.bubbleOut&&this.events.bubbleOut(event,data,local),this},bubble:function(event,data,local){return"undefined"!=typeof this.events.bubble&&this.events.bubble(event,data,local),this},isEnabled:function(){var c=this.config();return c.enabled!==!1&&"undefined"!=typeof c.enabled},disable:function(bubble){return"undefined"!=typeof bubble&&bubble?this.bubbleIn("disable",{__forcedEnable__:!0}):this.trigger("disable",{__forcedEnable__:!0}),this},enable:function(bubble){return"undefined"!=typeof bubble&&bubble?this.bubbleIn("enable",{__forcedEnable__:!0}):this.trigger("enable",{__forcedEnable__:!0}),this},show:function(){return this.config({visible:!0}),this},hide:function(){return this.config({visible:!1}),this},update:function(){return this.trigger("update"),this},focus:function(){return this.events.trigger("focus"),this}}),c.defineVariables();var cIndex=jsCow.componentsObjectList.length;c.id("c_"+cIndex+"_"+((new Date).getTime()+""+Math.floor(1e6*Math.random())).substr(0,18));var eventsManager=new jsCow.res.core.events.eventsManager;eventsManager.cmp(c),eventsManager.parent(c),c.events=eventsManager,c.on("model.ready",function(e){$.isEmptyObject(e.sender.__preConfig__.model)||e.sender.config(e.sender.__preConfig__.model),$.each(this.__preConfig__,function(self){return function(i,args){"undefined"!=typeof self[i]?"model"!==i&&(args instanceof Array?self[i].apply(self,args):self[i].apply(self,[args])):"model"!==i&&console.warn("Configuration parameter could not be set. The method '"+i+"' doesn't exists for component '"+self.id()+"'!")}}(this))});var controllerHandler=new jsCow.res.core.mvc.controllerHandler;controllerHandler.events=c.events,controllerHandler.__cmp__=c,c.__controller__=controllerHandler;var viewsManager=new jsCow.res.core.mvc.viewsManager;return viewsManager.__cmp__=c,c.__view__=viewsManager,c.createPlaceholder(cIndex),c.init(),jsCow.componentsObjectList[cIndex]=c,c=null,jsCow.componentsObjectList[cIndex]}return console.log("The ressource of a component does not exists!"),{}},find:function(component){var cid,foundCmp;return"object"==typeof component&&(cid=component.id()),foundCmp=!1,$.each(jsCow.componentsObjectList,function(i,c){c.id()===component&&(foundCmp=c)}),foundCmp}},jsCow.components=new component,jsCow.res.core.mvc.viewsManager=function(){this.viewList=[]},jsCow.res.core.mvc.viewsManager.prototype={init:function(config){var self=this,viewList=this.list();$.each(viewList,function(i,view){view.isInit||("undefined"!==view.dom&&"undefined"!==view.dom.main&&(0===i&&self.cmp().placeholder()&&self.cmp().placeholder().replaceWith(view.dom.main),i>0&&viewList[i-1].dom.main.after(view.dom.main)),view.isInit=!0)})},list:function(){return this.viewList},addView:function(v){var self=this,length=this.length();this.viewList[length]=new v,this.viewList[length].__cmp__=this.cmp(),this.viewList[length].__cfg__={};var eventsManager=new jsCow.res.core.events.eventsManager;return eventsManager.cmp(this.cmp()),eventsManager.parent(this.viewList[length]),this.viewList[length].events=eventsManager,$.extend(!0,this.viewList[length],{cmp:function(){return this.__cmp__},main:function(){return this.dom.main},content:function(){return this.dom.content?this.dom.content:!1},appendToTarget:function(){return $(this.dom.main).appendTo(this.cmp().target()),this},appendAfter:function(target){return target.after(this.dom.main),this},cfg:function(param){return void 0===param?this.__cfg__:this.__cfg__[param]?this.__cfg__[param]:!1},id:function(id){return id?(this.__id__=id,this):this.__id__},focus:function(e){$(".jsc-focus").removeClass("jsc-focus"),this.dom.main.addClass("jsc-focus")},on:function(event,handler,local){return this.events.on(event,handler,local),this},trigger:function(event,data,local){return this.events.trigger(event,data,local),this},bubbleIn:function(event,data,local){return this.events.bubbleIn(event,data,local),this},bubbleOut:function(event,data,local){return this.events.bubbleOut(event,data,local),this},bubble:function(event,data,local){return this.events.bubble(event,data,local),this}}),this.viewList[length].id("v"+((new Date).getTime()+""+Math.floor(1e6*Math.random())).substr(0,18)),this.viewList[length].on("view.init",this.viewList[length].init),this.viewList[length].on("view.update",this.viewList[length].update),this.viewList[length].on("view.focus",this.viewList[length].focus),this.viewList[length].dom.main.mousedown(function(self,length){return function(e){e.stopPropagation(),self.viewList[length].trigger("view.focus")}}(self,length)),this.viewList[length]},add:function(v){return this.addView(v),this},del:function(view){var v=new view,viewList=this.list();$.each(viewList,function(i,view){v.id()===view.id()&&("undefined"!==view.dom.main&&view.dom.main.remove(),viewList.splice(i,1))})},update:function(e){var self=this,viewList=this.list();$.each(viewList,function(i,view){self.cmp().trigger("view.update")})},length:function(){return this.viewList.length},content:function(idx){var index;index=void 0===idx?0:idx;var self=this,viewList=this.list(),content=!1;return $.each(viewList,function(i,view){if("undefined"!==view.dom&&"undefined"!==view.dom.content&&"object"==typeof view.dom.content&&view.dom.content instanceof Array)view.dom.content[index]&&(content=view.dom.content[index]);else{if(void 0===view.dom||void 0===view.dom.content)return self.main(index);content=view.dom.content}}),content},main:function(idx){var index;index=void 0===idx?0:idx;var viewList=this.list(),main=!1;return $.each(viewList,function(i,view){"undefined"!==view.dom&&"undefined"!==view.dom.main&&"object"==typeof view.dom.main&&view.dom.main instanceof Array?view.dom.main[index]&&(main=view.dom.main[index]):main="undefined"!==view.dom&&"undefined"!==view.dom.main?view.dom.main:!1}),main},cmp:function(){return this.__cmp__},appendTo:function(target){var self=this,viewList=this.list();return $.each(viewList,function(i,view){view.main().appendTo(target),self.cmp().target(target)}),this},removeAll:function(){var viewList=this.list();return $.each(viewList,function(i,view){"undefined"!==view.dom.main&&view.dom.main.remove()}),this.cmp()},replace:function(o,n){var oV=new o,_this=this,viewList=this.list();$.each(viewList,function(i,view){view.id()===oV.id()&&(_this.addView(n).appendAfter(view.main()),_this.del(o))})},style:function(css){var style=css,viewList=this.list();$.each(viewList,function(i,view){"object"==typeof style?view.main().css(style):"string"==typeof style&&view.main().addClass(style)})}},jsCow.res.core.mvc.controllerHandler=function(){this.controllerList=[],this.__cmp__=!1,this.events=!1},jsCow.res.core.mvc.controllerHandler.prototype={controllers:function(){return this.controllerList},add:function(c){$.extend(!0,c.prototype,{model:function(){return this.__model__},view:function(){return this.__view__},cmp:function(){return this.__cmp__},__update__:function(e){return this.trigger("view.update",this.cmp().config()),this.trigger("updated",this.cmp().config()),this},id:function(id){return id?(this.__id__=id,this):this.__id__},enable:function(e){var c=this.cmp().config();return c.enabled!==!1&&"undefined"!=typeof c.enabled||!(!this.cmp().parent()||this.cmp().parent()&&this.cmp().parent().isEnabled())||(this.cmp().config({enabled:!0}),this.trigger("enabled",this.cmp().config(e.data)),$.each(this.cmp().children(),function(self){return function(i,c){var cfg=c.config();"undefined"!=typeof cfg.__forcedEnable__&&cfg.__forcedEnable__||(e.data.__forcedEnable__=!1,c.trigger("enable",e.data))}}(this))),this},disable:function(e){var c=this.cmp().config();return c.enabled===!0&&"undefined"!=typeof c.enabled&&(this.cmp().config({enabled:!1}),this.trigger("disabled",this.cmp().config(e.data)),$.each(this.cmp().children(),function(self){return function(i,c){e.data.__forcedEnable__=!1,c.trigger("disable",e.data)}}(this))),this},show:function(e){return this.cmp().config({visible:!0}),this.trigger("showed",this.cmp().config()),this},hide:function(e){return this.cmp().config({visible:!1}),this.trigger("hidden",this.cmp().config()),this},on:function(event,handler,local){return this.events.on(event,handler,local),this},trigger:function(event,data,local){return this.events.trigger(event,data,local),this},bubbleIn:function(event,data,local){return this.events.bubbleIn(event,data,local),this},bubbleOut:function(event,data,local){return this.events.bubbleOut(event,data,local),this},bubble:function(event,data,local){return this.events.bubble(event,data,local),this}});var length=this.length();this.controllerList[length]=new c,this.controllerList[length].__view__=this.cmp().view(),this.controllerList[length].__model__=this.cmp().model(),this.controllerList[length].__cmp__=this.cmp(),this.controllerList[length].id("c"+((new Date).getTime()+""+Math.floor(1e6*Math.random())).substr(0,18));var eventsManager=new jsCow.res.core.events.eventsManager;return eventsManager.cmp(this.cmp()),eventsManager.parent(this.controllerList[length]),this.controllerList[length].events=eventsManager,this.controllerList[length].on("controller.init",this.controllerList[length].init,!0),this.controllerList[length].on("controller.update",this.controllerList[length].update,!0),this.controllerList[length].on("show",this.controllerList[length].show),this.controllerList[length].on("hide",this.controllerList[length].hide),this.controllerList[length].on("enable",this.controllerList[length].enable),this.controllerList[length].on("disable",this.controllerList[length].disable),this.controllerList[length].on("update",this.controllerList[length].__update__),this},length:function(){return this.controllerList.length},cmp:function(){return this.__cmp__},del:function(controller){var c,controllerList;return c=new controller,controllerList=this.controllers(),$.each(controllerList,function(i,controller){c.id()===controller.id()&&controllerList.splice(i,1)}),this}},jsCow.res.components.nodeeditor=function(){},jsCow.res.components.nodeeditor.prototype={init:function(){return this.addController(jsCow.res.controller.nodeeditor),this.addModel(jsCow.res.model.nodeeditor),this.addView(jsCow.res.view.nodeeditor),this},options:function(options){return"undefined"!=typeof options&&"object"==typeof options&&this.trigger("options",{options:options}),this},addNode:function(options){var list=[];return options instanceof Array?list=options:list.push(options),this.trigger("nodes.add",{nodes:list}),this},addConnection:function(options){var list=[];return options instanceof Array?list=options:list.push(options),this.trigger("connection.add",{connections:list}),this},removeConnection:function(options){var list=[];return options instanceof Array?list=options:list.push(options),this.trigger("connection.remove",{connections:list}),this},removeNode:function(id){return"String"==typeof options&&this.trigger("node.remove",{id:id}),this},addNodesRepository:function(repo){return"object"==typeof repo&&this.trigger("editor.repository.add",{repository:repo}),this}},jsCow.res.model.nodeeditor=function(){this.data={enabled:!0,visible:!0,options:{grid:20,snapToGrid:!0},nodes:{},connections:[],repositories:{}}},jsCow.res.model.nodeeditor.prototype={init:function(){this.trigger("model.ready",this.data)}},jsCow.res.view.nodeeditor=function(){this.config={contentSize:{width:null,height:null},grid:{data:[]},jsPlumbInstance:null,newNodePos:{left:0,top:0}},this.dom={},this.dom.main=$("<div/>").addClass("jsc-nodeeditor"),this.dom.grid=$("<div/>").addClass("jsc-nodeeditor-grid").appendTo(this.dom.main),this.dom.content=$("<div/>").addClass("jsc-nodeeditor-content").on("dblclick",function(self){return function(e){self.config.newNodePos={left:e.offsetX-85,top:e.offsetY-10},self.dom.nodeselector.slideDown().find("input").focus()}}(this)).appendTo(this.dom.grid),this.dom.nodeselector=$("<div/>").addClass("jsc-nodeeditor-nodeselector").hide().appendTo(this.dom.main),this.dom.nodeselectorinput=$('<input type="text" value="" placeholder="Search..." />').appendTo(this.dom.nodeselector),this.dom.nodeselectorresults=$("<ul/>").attr("data-keyboard-focus-group","").appendTo(this.dom.nodeselector)},jsCow.res.view.nodeeditor.prototype={init:function(e){var self=this;this.on("editor.node.added",this.editorNodeAdded),this.on("editor.node.updated",this.editorNodeUpdated),this.on("editor.node.types.updated",this.onEditorNodeTypesUpdated),this.on("editor.connection.added",this.editorConnectionAdded),this.on("node.remove",this.nodeRemove),this.on("editor.grid.update",this.updateGrid),this.dom.grid.kinetic(),this.dom.svggrid=d3.select(this.dom.content[0]).append("svg:svg").attr("width","100%").attr("height","100%"),jsPlumb.ready(function(self){return function(){self.config.jsPlumbInstance=jsPlumb.getInstance(),self.config.jsPlumbInstance.setContainer(self.dom.content),self.config.jsPlumbInstance.bind("connectionDragStop",function(connection){if(connection.source&&connection.target){var from=connection.sourceId.split("-"),to=connection.targetId.split("-");self.cmp().addConnection({from:{node:from[from.length-2],out:from[from.length-1]},to:{node:to[to.length-2],"in":to[to.length-1]}}),console.info("ADD CONNECTION",connection.id)}}),self.config.jsPlumbInstance.bind("beforeDrop",function(info){return info.sourceId===info.targetId?!1:void 0})}}(this)),this.dom.nodeselectorinput.keyup(function(self){return function(e){13===e.keyCode&&self.dom.nodeselector.fadeOut(),40===e.keyCode&&self.dom.nodeselectorresults.find("div").eq(0).focus(),27===e.keyCode&&self.dom.nodeselector.fadeOut()}}(this)),$(document).on("keydown",function(e){var currentFocusElement,currentFocusGroupItems,prevIndex,nextIndex;38===e.which&&(currentFocusElement=$(":focus"),currentFocusGroupItems=currentFocusElement.closest("[data-keyboard-focus-group]").find("[data-keyboard-focus]"),prevIndex=currentFocusGroupItems.index(currentFocusElement)-1,0>prevIndex&&(prevIndex=0,self.dom.nodeselectorinput.focus()),$(currentFocusGroupItems).eq(prevIndex).focus()),40===e.which&&(currentFocusElement=$(":focus"),currentFocusGroupItems=currentFocusElement.closest("[data-keyboard-focus-group]").find("[data-keyboard-focus]"),nextIndex=currentFocusGroupItems.index(currentFocusElement)+1,$(currentFocusGroupItems).eq(nextIndex).focus())}).keyup(function(e){13===e.which&&$(":focus").click()}),this.trigger("view.update",e.data)},update:function(e){e.data.enabled?(this.dom.main.removeClass("jsc-nodeeditor-disabled").addClass("jsc-nodeeditor"),e.data.visible?this.dom.main.show():this.dom.main.hide()):this.dom.main.removeClass("jsc-nodeeditor").addClass("jsc-nodeeditor-disabled")},editorNodeAdded:function(e){var self=this,cfg=this.cmp().config(),nodeOptions=e.data;nodeOptions.grid=cfg.options.grid,nodeOptions.snapToGrid=cfg.options.snapToGrid,nodeOptions.jsPlumbInstance=this.cfg.jsPlumbInstance;var main=$("<div/>").attr("id",this.cmp().id()+"-"+nodeOptions.id).addClass("jsc-node clearfix").css({top:nodeOptions.pos.top,left:nodeOptions.pos.left}),content=$("<div/>").addClass("jsc-node-content clearfix").appendTo(main),titlebar=$("<div/>").addClass("jsc-node-titlebar").append($("<span/>").html(nodeOptions.title));main.prepend(titlebar);var outputs=($("<i/>").addClass("jsc-node-remove fa fa-times").click(function(e){self.trigger("node.remove",{id:nodeOptions.id})}).appendTo(titlebar),$("<div/>").addClass("jsc-node-outputs").appendTo(content)),preview=$("<div/>").addClass("jsc-node-preview").appendTo(content),inputs=($("<div/>").appendTo(preview),$("<div/>").addClass("jsc-node-inputs").appendTo(content));$.each(nodeOptions.outputs,function(i,output){var id=self.cmp().id()+"-"+nodeOptions.id+"-"+output.id,port=$("<div/>").addClass("jsc-node-port jsc-node-port-out").attr("id",id);$("<div/>").appendTo(port).append($("<span/>").text(output.title)),outputs.append(port),window.setTimeout(function(){self.config.jsPlumbInstance.makeSource(id,{anchor:["RightMiddle"],isSource:!0,sourceDetachable:!0})},0)}),$.each(nodeOptions.inputs,function(i,input){var id=self.cmp().id()+"-"+nodeOptions.id+"-"+input.id,port=$("<div/>").addClass("jsc-node-port jsc-node-port-in").attr("id",id);$("<div/>").appendTo(port).append($("<span/>").text(input.title)),inputs.append(port),window.setTimeout(function(){self.config.jsPlumbInstance.makeTarget(id,{anchor:["LeftMiddle"],isTarget:!0,targetReattach:!0})},0)}),this.dom.content.append(main),this.config.jsPlumbInstance.draggable(this.cmp().id()+"-"+nodeOptions.id,{grid:[nodeOptions.grid,nodeOptions.grid]})},editorNodeUpdated:function(e){e.data},editorConnectionAdded:function(e){var self=this,c=e.data;jsPlumb.ready(function(){var connectorOptions={connector:["Bezier",{curviness:100},{cssClass:"jsc-connector-bezier"}],anchor:["RightMiddle","LeftMiddle"],endpoint:["Dot",{radius:5}],overlays:[["Label",{cssClass:"jsc-connector-label",label:"x",location:.5,events:{click:function(labelOverlay,originalEvent){var from=labelOverlay.component.sourceId.split("-"),to=labelOverlay.component.targetId.split("-"),con={from:{node:from[from.length-2],out:from[from.length-1]},to:{node:to[to.length-2],"in":to[to.length-1]}};self.config.jsPlumbInstance.detach(labelOverlay.component),self.cmp().removeConnection(con),console.info("REMOVED CONNECTION",labelOverlay,labelOverlay.component.id,con)}}}]]};c.color?connectorOptions.paintStyle={strokeStyle:c.color}:connectorOptions.cssClass="jsc-connector-path";var source=self.cmp().id()+"-"+c.from.node+"-"+c.from.out,target=self.cmp().id()+"-"+c.to.node+"-"+c.to["in"];self.config.jsPlumbInstance.connect({source:source,target:target},connectorOptions)})},nodeRemove:function(e){var nodeId=e.data.id,connections=(this.cmp().config().nodes,this.cmp().config().connections),nodeElementId=this.cmp().id()+"-"+nodeId;$("#"+nodeElementId).remove();for(var allJsPlumbConnections=this.config.jsPlumbInstance.getConnections(),searchId="-"+nodeId+"-",pc=0;pc<allJsPlumbConnections.length;pc++)-1===allJsPlumbConnections[pc].sourceId.indexOf(searchId)&&-1===allJsPlumbConnections[pc].targetId.indexOf(searchId)||this.config.jsPlumbInstance.detach(allJsPlumbConnections[pc]);for(var c=0;c<connections.length;c++)connections[c].from.node!==nodeId&&connections[c].to.node!==nodeId||this.cmp().removeConnection(connections[c])},onEditorNodeTypesUpdated:function(e){var nodeTypeGroups=e.data;this.dom.nodeselectorresults.find("*").remove();var typeClickHandler=function(self,type){return function(){type.id=("node"+Math.random()).replace(".",""),type.pos={left:self.config.newNodePos.left,top:self.config.newNodePos.top},self.cmp().addNode(type)}};for(var key in nodeTypeGroups){this.dom.nodeselectorresults.append('<li class="jsc-nodeeditor-nodegroup">'+nodeTypeGroups[key].title+"</li>");for(var item=$("<li/>"),t=0;t<nodeTypeGroups[key].types.length;t++){var type=nodeTypeGroups[key].types[t],typeButton=$("<div>"+type.title+"</div>").attr("data-keyboard-focus","").attr("tabindex","-1");typeButton.on("click",typeClickHandler(this,type)).appendTo(item)}this.dom.nodeselectorresults.append(item),this.dom.nodeselectorresults.find("div").eq(0).focus()}},updateNodes:function(e){var self=this;$(this.cmp().children()).each(function(that){return function(i,c){c.del()}}(this));e.data.options.nodes.length;$(e.data.options.nodes).each(function(that,e){return function(i,nodeOptions){nodeOptions.grid=e.data.options.grid,nodeOptions.snapToGrid=e.data.options.snapToGrid,nodeOptions.jsPlumbInstance=that.config.jsPlumbInstance;var main=$("<div/>").attr("id",self.cmp().id()+"-"+nodeOptions.id).addClass("jsc-node clearfix").css({top:nodeOptions.pos.top,
left:nodeOptions.pos.left}),content=$("<div/>").addClass("jsc-node-content clearfix").appendTo(main),titlebar=$("<div/>").addClass("jsc-node-titlebar");$("<span/>").html(nodeOptions.title).appendTo(titlebar),$("<i/>").addClass("jsc-node-remove fa fa-times").appendTo(titlebar);main.prepend(titlebar);var outputs=$("<div/>").addClass("jsc-node-outputs").appendTo(content),preview=$("<div/>").addClass("jsc-node-preview").appendTo(content),typePreviewImage=$("<div/>").appendTo(preview);$('<img src="http://image.shutterstock.com/display_pic_with_logo/2904091/292004621/stock-photo--d-sphere-on-white-background-with-word-cloud-texture-imprint-this-ball-with-tag-cloud-text-are-in-292004621.jpg" alt="" />').appendTo(typePreviewImage);var config=$("<div/>").addClass("jsc-node-config").appendTo(content),typeInput=$("<div/>").appendTo(config);$('<input type="text" value="" />').appendTo(typeInput);var typeSelect=$("<div/>").appendTo(config),typeSelectField=$("<select/>").appendTo(typeSelect);typeSelectField.append("<option>Muh</option>"),typeSelectField.append("<option>Kuh</option>");var typeRadio=$("<div/>").appendTo(config),typeRadioLabel=$("<label/>").appendTo(typeRadio);$('<input type="radio" name="test" value="1" />').appendTo(typeRadioLabel),$("<span/>").text("Aktiv").appendTo(typeRadioLabel);var typeChekbox=$("<div/>").appendTo(config),typeChekboxLabel=$("<label/>").appendTo(typeChekbox);$('<input type="checkbox" name="test1" value="1" />').appendTo(typeChekboxLabel),$("<span/>").text("Aktiv").appendTo(typeChekboxLabel);var inputs=$("<div/>").addClass("jsc-node-inputs").appendTo(content);$.each(nodeOptions.outputs,function(i,output){var port=$("<div/>").addClass("jsc-node-port jsc-node-port-out").attr("id",self.cmp().id()+"-"+nodeOptions.id+"-"+output.id);$("<div/>").appendTo(port).append($("<span/>").text(output.title)),outputs.append(port)}),$.each(nodeOptions.inputs,function(i,input){var port=$("<div/>").addClass("jsc-node-port jsc-node-port-in").attr("id",self.cmp().id()+"-"+nodeOptions.id+"-"+input.id);$("<div/>").appendTo(port).append($("<span/>").text(input.title)),inputs.append(port)}),that.dom.content.append(main),self.config.jsPlumbInstance.draggable(self.cmp().id()+"-"+nodeOptions.id,{grid:[nodeOptions.grid,nodeOptions.grid]})}}(this,e)).promise().done(function(){self.trigger("update.content.size"),self.trigger("update.connectors")})},updateContentSize:function(e){this.config.contentSize.width=this.dom.main.outerWidth(!0),this.config.contentSize.height=this.dom.main.outerHeight(!0);for(var nodes=$(this.dom.content).find(".jsc-node"),i=0;i<nodes.length;i++){var node=$(nodes[i]),rightPos=node.position().left+node.outerWidth(!0),bottomPos=node.position().top+node.outerHeight(!0);rightPos>this.config.contentSize.width&&(this.config.contentSize.width=rightPos),bottomPos>this.config.contentSize.height&&(this.config.contentSize.height=bottomPos)}this.dom.content.width(this.config.contentSize.width).height(this.config.contentSize.height)},updateGrid:function(e){if(this.dom.svggrid&&"undefined"!==this.dom.svggrid.append){var width=0,height=0;this.config.contentSize.width&&this.config.contentSize.height?(width=this.config.contentSize.width,height=this.config.contentSize.height):(width=$(this.dom.content).outerWidth(!0),height=$(this.dom.content).outerHeight(!0)),this.config.grid={data:{x:function(){for(var lines=[],i=0;i*e.data.options.grid<width;i++)lines.push(i*e.data.options.grid);return lines}(),y:function(){for(var lines=[],i=0;i*e.data.options.grid<height;i++)lines.push(i*e.data.options.grid);return lines}()}},this.dom.svggrid.selectAll(".jsc-nodeeditor-grid-group-x").remove(),this.dom.svggrid.selectAll("line.jsc-nodeeditor-grid-x").remove(),this.dom.svggrid.append("g").attr("class","jsc-nodeeditor-grid-group-x").selectAll("line.jsc-nodeeditor-grid-x").data(this.config.grid.data.x).enter().append("line").attr("x1",function(d){return d}).attr("y1",0).attr("x2",function(d){return d}).attr("y2","100%").attr("class","jsc-nodeeditor-grid-x"),this.dom.svggrid.selectAll(".jsc-nodeeditor-grid-group-y").remove(),this.dom.svggrid.selectAll("line.jsc-nodeeditor-grid-y").remove(),this.dom.svggrid.append("g").attr("class","jsc-nodeeditor-grid-group-y").selectAll("line.jsc-nodeeditor-grid-y").data(this.config.grid.data.y).enter().append("line").attr("x1",0).attr("y1",function(d){return d}).attr("x2","100%").attr("y2",function(d){return d}).attr("class","jsc-nodeeditor-grid-y")}}},jsCow.res.controller.nodeeditor=function(){},jsCow.res.controller.nodeeditor.prototype={init:function(){this.on("model.ready",this.isModelReady),this.on("options",this.options),this.on("nodes.add",this.addNode),this.on("node.remove",this.nodeRemove),this.on("connection.add",this.addConnection),this.on("connection.remove",this.removeConnection),this.on("editor.repository.add",this.addNodesRepository)},isModelReady:function(){this.trigger("view.init",this.cmp().config())},options:function(e){this.cmp().config({options:e.data.options}),this.trigger("editor.options.updated",e.data.options)},addNode:function(e){var newNodesList=e.data.nodes,nodes=this.cmp().config().nodes;if($.isEmptyObject(nodes))for(i=0;i<newNodesList.length;i++)nodes[newNodesList[i].id]=newNodesList[i],this.trigger("editor.node.added",newNodesList[i]),console.info("NODE ADDED",newNodesList[i]);else for(var nn=0;nn<newNodesList.length;nn++){nodes=this.cmp().config().nodes;var updateNode={};updateNode[newNodesList[nn].id]=newNodesList[nn],"undefined"==typeof nodes[newNodesList[nn].id]?(nodes[newNodesList[nn].id]={},nodes[newNodesList[nn].id]=updateNode,this.trigger("editor.node.added",newNodesList[nn]),console.info("NODE ADDED",newNodesList[nn])):(nodes[newNodesList[nn].id]=updateNode,this.trigger("editor.node.updated",newNodesList[nn]),console.info("NODE UPDATED",newNodesList[nn]))}},addConnection:function(e){for(var nodes=this.cmp().config().nodes,connections=this.cmp().config().connections,newConnections=e.data.connections,i=0;i<newConnections.length;i++){var nodeExists=!1,connectionExists=!1;if(nodes[newConnections[i].from.node]&&nodes[newConnections[i].to.node]){nodeExists=!0;for(var c=0;c<connections.length;c++)connections[c].from.node===newConnections[i].from.node&&connections[c].from.out===newConnections[i].from.out&&connections[c].to.node===newConnections[i].to.node&&connections[c].to["in"]===newConnections[i].to["in"]&&(connectionExists=!0)}!connectionExists&&nodeExists&&(console.info("CONNECTION ADDED",newConnections[i]),this.cmp().config({connections:connections.concat(newConnections[i])}),this.trigger("editor.connection.added",newConnections[i]),connections=this.cmp().config().connections)}},removeConnection:function(e){for(var connections=(this.cmp().config().nodes,this.cmp().config().connections),removeConnections=e.data.connections,i=0;i<removeConnections.length;i++)for(var c=0;c<connections.length;c++)connections[c].from.node===removeConnections[i].from.node&&connections[c].from.out===removeConnections[i].from.out&&connections[c].to.node===removeConnections[i].to.node&&connections[c].to["in"]===removeConnections[i].to["in"]&&connections.splice(c,1)},nodeRemove:function(e){var nodeId=e.data.id,nodes=this.cmp().config().nodes;nodes[nodeId]&&(delete this.cmp().config().nodes[nodeId],console.info("NODE DELETED",nodeId))},addNodesRepository:function(e){var repositories=this.cmp().config().repositories,newRepo=e.data.repository;repositories[newRepo.group]?(repositories[newRepo.group].types.push(newRepo.types),this.cmp().config({repositories:repositories}),this.trigger("editor.node.types.updated",this.cmp().config().repositories)):(repositories[newRepo.group]=newRepo,this.cmp().config({repositories:repositories}),this.trigger("editor.node.types.updated",this.cmp().config().repositories))}},jsCow.res.components.node=function(){},jsCow.res.components.node.prototype={init:function(){return this.addController(jsCow.res.controller.node),this.addModel(jsCow.res.model.node),this.addView(jsCow.res.view.node),this},title:function(title){return"undefined"!=typeof title&&"string"==typeof title&&this.trigger("title",{title:title}),this},inputs:function(params){return"undefined"!=typeof params&&"string"==typeof params&&this.trigger("inputs",{inputs:params}),this},outputs:function(params){return"undefined"!=typeof params&&"string"==typeof params&&this.trigger("inputs",{outputs:params}),this},addInPorts:function(ports){return"undefined"!=typeof options&&typeof options instanceof Array&&this.trigger("addInPorts",{ports:ports}),this}},jsCow.res.model.node=function(){this.data={enabled:!0,visible:!0,title:"",pos:{left:null,top:null},inputs:[],outputs:[],config:{},preview:{}}},jsCow.res.model.node.prototype={init:function(){this.trigger("model.ready",this.data)}},jsCow.res.view.node=function(){this.dom={},this.dom.main=$("<div/>").addClass("jsc-node clearfix"),this.dom.content=$("<div/>").addClass("jsc-node-content clearfix").appendTo(this.dom.main),this.dom.titlebar=$("<div/>").addClass("jsc-node-titlebar"),this.dom.title=$("<span/>").appendTo(this.dom.titlebar),this.dom.remove=$("<i/>").addClass("jsc-node-remove fa fa-times").appendTo(this.dom.titlebar),this.dom.main.prepend(this.dom.titlebar),this.dom.outputs=$("<div/>").addClass("jsc-node-outputs").appendTo(this.dom.content),this.dom.preview=$("<div/>").addClass("jsc-node-preview").appendTo(this.dom.content),this.dom.config=$("<div/>").addClass("jsc-node-config").appendTo(this.dom.content),this.dom.inputs=$("<div/>").addClass("jsc-node-inputs").appendTo(this.dom.content),this.dragstart=!1,this.mousePosX=0,this.mousePosY=0,this.nodePosX=0,this.nodePosY=0,this.newNodePosX=0,this.newNodePosY=0,this.ports={inputs:[],outputs:[]}},jsCow.res.view.node.prototype={init:function(e){this.dom.main.attr("id",e.data.id);var modelConfig=this.cmp().config();this.newNodePosX=modelConfig.pos.left,this.newNodePosY=modelConfig.pos.top,this.dom.remove.on("click",function(self,e){return function(){self.cmp().del(),self.trigger("removed",{id:e.data.id})}}(this,e)),this.trigger("view.update",e.data)},update:function(e){e.data.enabled?(this.dom.main.removeClass("jsc-node-disabled").addClass("jsc-node"),this.dom.title.html(e.data.title),this.dom.main.css("left",e.data.pos.left),this.dom.main.css("top",e.data.pos.top),this.dom.outputs.find("*").remove(),$.each(e.data.outputs,function(that){return function(i,output){var port=$("<div/>").addClass("jsc-node-port jsc-node-port-out");$("<i/>").attr("id",that.cmp().id()+"-"+output.id).appendTo(port),$("<div/>").appendTo(port).append($("<span/>").text(output.title)),that.dom.outputs.append(port)}}(this)),this.dom.inputs.find("*").remove(),$.each(e.data.inputs,function(that){return function(i,input){var port=$("<div/>").addClass("jsc-node-port jsc-node-port-in");$("<i/>").attr("id",that.cmp().id()+"-"+input.id).appendTo(port),$("<div/>").appendTo(port).append($("<span/>").text(input.title)),that.dom.inputs.append(port)}}(this)),e.data.visible?this.dom.main.show():this.dom.main.hide()):this.dom.main.removeClass("jsc-node").addClass("jsc-node-disabled")}},jsCow.res.controller.node=function(){},jsCow.res.controller.node.prototype={init:function(){this.on("model.ready",this.isModelReady),this.on("title",this.title),this.on("inputs",this.inputs),this.on("outputs",this.outputs),this.on("addInPorts",this.addInPorts)},isModelReady:function(){this.trigger("view.init",this.cmp().config())},title:function(e){this.cmp().config({title:e.data.title})},inputs:function(e){this.cmp().config({inputs:e.data.inputs})},outputs:function(e){this.cmp().config({outputs:e.data.outputs})},addInPorts:function(e){this.trigger("inputs",e.data.ports)}};